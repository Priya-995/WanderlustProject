<% layout('/layouts/boilerplate') -%>

<div class="min-h-screen flex items-center justify-center  py-38 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        

        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8">

            <form action="/signup" method="POST" class="space-y-6" id="signupForm" novalidate>
                <!-- Header -->
        <div class="text-center">
            <h2 class="text-3xl font-extrabold text-gray-900">
                Create your account
            </h2>
            <p class="mt-2 text-sm text-gray-600">
                Join us today and get started
            </p>
        </div>
                <!-- Username Field -->
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
                        Username
                    </label>
                    <input 
                        id="username" 
                        name="username" 
                        type="text" 
                        autocomplete="username"
                        class="appearance-none relative block w-full px-4 py-3 border border-gray-300 rounded-lg placeholder-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-150 ease-in-out sm:text-sm"
                        placeholder="Choose a username"
                    >
                    <p class="mt-2 text-xs text-red-600 hidden" id="usernameError"></p>
                </div>

                <!-- Email Field -->
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                        Email address
                    </label>
                    <input 
                        id="email" 
                        name="email" 
                        type="text" 
                        autocomplete="email"
                        class="appearance-none relative block w-full px-4 py-3 border border-gray-300 rounded-lg placeholder-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-150 ease-in-out sm:text-sm"
                        placeholder="you@example.com"
                    >
                    <p class="mt-2 text-xs text-red-600 hidden" id="emailError"></p>
                </div>

                <!-- Password Field -->
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                        Password
                    </label>
                    <input 
                        id="password" 
                        name="password" 
                        type="password" 
                        autocomplete="new-password"
                        class="appearance-none relative block w-full px-4 py-3 border border-gray-300 rounded-lg placeholder-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-150 ease-in-out sm:text-sm"
                        placeholder="Create a strong password"
                    >
                    <p class="mt-2 text-xs text-gray-500" id="passwordHint">
                        Must be at least 8 characters long
                    </p>
                    <p class="mt-2 text-xs text-red-600 hidden" id="passwordError"></p>
                    <!-- Password Strength Indicator -->
                    <div class="mt-2 hidden" id="passwordStrength">
                        <div class="flex gap-1">
                            <div class="h-1 flex-1 rounded-full bg-gray-200" id="strength1"></div>
                            <div class="h-1 flex-1 rounded-full bg-gray-200" id="strength2"></div>
                            <div class="h-1 flex-1 rounded-full bg-gray-200" id="strength3"></div>
                            <div class="h-1 flex-1 rounded-full bg-gray-200" id="strength4"></div>
                        </div>
                        <p class="text-xs mt-1" id="strengthText"></p>
                    </div>
                </div>

                <!-- Submit Button -->
                <div>
                    <button 
                        type="submit"
                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out transform hover:scale-[1.02] active:scale-[0.98]"
                    >
                        Sign up
                    </button>
                </div>

                <!-- Login Link -->
                <div class="text-center">
                    <p class="text-sm text-gray-600">
                        Already have an account? 
                        <a href="/login" class="font-medium text-indigo-600 hover:text-indigo-500 transition duration-150 ease-in-out">
                            Log in
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('signupForm');
    const username = document.getElementById('username');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    
    const usernameError = document.getElementById('usernameError');
    const emailError = document.getElementById('emailError');
    const passwordError = document.getElementById('passwordError');
    const passwordHint = document.getElementById('passwordHint');
    const passwordStrength = document.getElementById('passwordStrength');
    const strengthText = document.getElementById('strengthText');

    // Validation functions
    function validateUsername(value) {
        if (!value || value.trim().length === 0) {
            return 'Username is required';
        }
        if (value.length < 3) {
            return 'Username must be at least 3 characters long';
        }
        if (value.length > 20) {
            return 'Username must be less than 20 characters';
        }
        if (!/^[a-zA-Z0-9_]+$/.test(value)) {
            return 'Username can only contain letters, numbers, and underscores';
        }
        return null;
    }

    function validateEmail(value) {
        if (!value || value.trim().length === 0) {
            return 'Email is required';
        }
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
            return 'Please enter a valid email address';
        }
        return null;
    }

    function validatePassword(value) {
        if (!value || value.length === 0) {
            return 'Password is required';
        }
        if (value.length < 8) {
            return 'Password must be at least 8 characters long';
        }
        return null;
    }

    function calculatePasswordStrength(value) {
        let strength = 0;
        if (value.length >= 8) strength++;
        if (value.length >= 12) strength++;
        if (/[a-z]/.test(value) && /[A-Z]/.test(value)) strength++;
        if (/\d/.test(value)) strength++;
        if (/[^a-zA-Z0-9]/.test(value)) strength++;
        
        return Math.min(strength, 4);
    }

    function showError(input, errorElement, message) {
        input.classList.remove('border-gray-300', 'focus:ring-indigo-500');
        input.classList.add('border-red-500', 'focus:ring-red-500');
        errorElement.textContent = message;
        errorElement.classList.remove('hidden');
    }

    function clearError(input, errorElement) {
        input.classList.remove('border-red-500', 'focus:ring-red-500');
        input.classList.add('border-gray-300', 'focus:ring-indigo-500');
        errorElement.classList.add('hidden');
    }

    // Real-time validation on blur
    username.addEventListener('blur', function() {
        const error = validateUsername(this.value);
        if (error) {
            showError(username, usernameError, error);
        } else {
            clearError(username, usernameError);
        }
    });

    username.addEventListener('input', function() {
        if (usernameError.textContent) {
            const error = validateUsername(this.value);
            if (!error) {
                clearError(username, usernameError);
            }
        }
    });

    email.addEventListener('blur', function() {
        const error = validateEmail(this.value);
        if (error) {
            showError(email, emailError, error);
        } else {
            clearError(email, emailError);
        }
    });

    email.addEventListener('input', function() {
        if (emailError.textContent) {
            const error = validateEmail(this.value);
            if (!error) {
                clearError(email, emailError);
            }
        }
    });

    password.addEventListener('input', function() {
        const value = this.value;
        
        // Show strength indicator if password has content
        if (value.length > 0) {
            passwordStrength.classList.remove('hidden');
            passwordHint.classList.add('hidden');
            
            const strength = calculatePasswordStrength(value);
            const bars = [
                document.getElementById('strength1'),
                document.getElementById('strength2'),
                document.getElementById('strength3'),
                document.getElementById('strength4')
            ];
            
            // Reset all bars
            bars.forEach(bar => {
                bar.className = 'h-1 flex-1 rounded-full bg-gray-200';
            });
            
            // Fill bars based on strength
            const colors = ['bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-green-500'];
            const labels = ['Weak', 'Fair', 'Good', 'Strong'];
            const textColors = ['text-red-600', 'text-orange-600', 'text-yellow-600', 'text-green-600'];
            
            for (let i = 0; i < strength; i++) {
                bars[i].className = `h-1 flex-1 rounded-full ${colors[strength - 1]}`;
            }
            
            strengthText.textContent = labels[strength - 1] || '';
            strengthText.className = `text-xs mt-1 ${textColors[strength - 1] || ''}`;
        } else {
            passwordStrength.classList.add('hidden');
            passwordHint.classList.remove('hidden');
        }
        
        // Clear error if password becomes valid
        if (passwordError.textContent) {
            const error = validatePassword(value);
            if (!error) {
                clearError(password, passwordError);
            }
        }
    });

    password.addEventListener('blur', function() {
        const error = validatePassword(this.value);
        if (error) {
            showError(password, passwordError, error);
            passwordHint.classList.add('hidden');
        }
    });

    // Form submission validation
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        let isValid = true;
        
        // Validate username
        const usernameErr = validateUsername(username.value);
        if (usernameErr) {
            showError(username, usernameError, usernameErr);
            isValid = false;
        } else {
            clearError(username, usernameError);
        }
        
        // Validate email
        const emailErr = validateEmail(email.value);
        if (emailErr) {
            showError(email, emailError, emailErr);
            isValid = false;
        } else {
            clearError(email, emailError);
        }
        
        // Validate password
        const passwordErr = validatePassword(password.value);
        if (passwordErr) {
            showError(password, passwordError, passwordErr);
            passwordHint.classList.add('hidden');
            isValid = false;
        } else {
            clearError(password, passwordError);
        }
        
        // If all valid, submit the form
        if (isValid) {
            form.submit();
        }
    });
});
</script>